<h1>Генерация ключей</h1>

<form id="key-form">
    <label for="duration">Срок действия ключа:</label>
    <select name="duration" id="duration">
        {% for label, _ in durations %}
        <option value="{{ loop.index0 }}">{{ label }}</option>
        {% endfor %}
    </select>
    <button type="submit">Сгенерировать</button>
</form>

<div id="key-result">
    {% if key %}
    <h3>Сгенерированный ключ:</h3>
    <p>{{ key }}</p>
    {% endif %}
</div>

<script>
window.initPage = function initPage() {
    const form = document.getElementById("key-form");
    form?.addEventListener("submit", async e => {
        e.preventDefault();
        const formData = new FormData(form);
        const res = await fetch("/admin/keys/generate", {
            method: "POST",
            body: formData,
            headers: {"X-Requested-With": "XMLHttpRequest"}
        });
        const html = await res.text();
        document.getElementById("key-result").innerHTML = html;
    });
};
initPage();
</script>