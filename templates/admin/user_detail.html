{% extends "admin/layout.html" %}

{% block content %}
<h1>Информация о пользователе</h1>

<p><strong>Username:</strong> {{ username }}</p>
<p><strong>chat_id:</strong> {{ chat_id }}</p>
<p><strong>Следующий refresh:</strong> {{ next_refresh }}</p>
<p><strong>Сайт:</strong> <a href="{{ profile_link }}" target="_blank">{{ site_name }}</a></p>
<p><strong>Статус:</strong> {{ status }}</p>


<h3>Действия</h3>
<button id="restore-btn">{{ button_text }}</button>

<div id="restore-options" style="display:none; margin-top:10px; border:1px solid #ccc; padding:10px;">
    <b>Восстановить доступ на:</b><br><br>

    <div>
        <b>Минуты:</b><br>
        <button type="button" onclick="restoreSub(3,'minutes')">3 минуты</button>
        <button type="button" onclick="restoreSub(30,'minutes')">30 минут</button>
        <button type="button" onclick="restoreSub(60,'minutes')">1 час</button>
    </div>

    <br>

    <div>
        <b>Дни:</b><br>
        <button type="button" onclick="restoreSub(1,'days')">1 день</button>
        <button type="button" onclick="restoreSub(7,'days')">7 дней</button>
        <button type="button" onclick="restoreSub(30,'days')">30 дней</button>
    </div>

    <br>
    <button type="button" id="cancel-restore">Отмена</button>
</div>

<form method="post" action="/admin/users/{{ chat_id }}/tokens" style="display:inline-block; margin-left:10px;">
    <button type="submit">Посмотреть токены</button>
</form>

<a href="/admin/users" style="margin-left:20px;">⬅️ Назад к списку</a>

{% if tokens %}
<h3>Токены пользователя</h3>
<p><strong>Access Token:</strong> {{ tokens.access_token }}</p>
<p><strong>Refresh Token:</strong> {{ tokens.refresh_token }}</p>
{% endif %}

<script>
document.getElementById("restore-btn").addEventListener("click", function() {
    document.getElementById("restore-options").style.display = "block";
});

document.getElementById("cancel-restore").addEventListener("click", function() {
    document.getElementById("restore-options").style.display = "none";
});

function restoreSub(value, unit) {
    fetch(`/admin/users/{{ chat_id }}/restore_subscription`, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `value=${value}&unit=${unit}`
    }).then(() => location.reload());
}
</script>

{% endblock %}
