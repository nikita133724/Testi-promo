{% extends "admin/layout.html" %}

{% block content %}
<h1>Информация о пользователе</h1>

<p><strong>Username:</strong> {{ username }}</p>
<p><strong>chat_id:</strong> {{ chat_id }}</p>
<p><strong>Следующий refresh:</strong> {{ next_refresh }}</p>
<p><strong>Сайт:</strong> <a href="{{ profile_link }}" target="_blank">{{ site_name }}</a></p>
<p><strong>Статус:</strong> {{ status }}</p>


<h3>Действия</h3>
<button id="restore-btn">{{ button_text }}</button>

<div id="restore-options" style="display:none; margin-top:10px;">
    <form id="restore-form">
        <label for="duration">Выберите срок подписки:</label>
        <select id="duration" name="duration">
            <option value="1">1 день</option>
            <option value="7">7 дней</option>
            <option value="30">30 дней</option>
        </select>
        <button type="submit">Восстановить</button>
        <button type="button" id="cancel-restore">Отмена</button>
    </form>
</div>

<form method="post" action="/admin/users/{{ chat_id }}/tokens" style="display:inline-block; margin-left:10px;">
    <button type="submit">Посмотреть токены</button>
</form>

<a href="/admin/users" style="margin-left:20px;">⬅️ Назад к списку</a>

{% if tokens %}
<h3>Токены пользователя</h3>
<p><strong>Access Token:</strong> {{ tokens.access_token }}</p>
<p><strong>Refresh Token:</strong> {{ tokens.refresh_token }}</p>
{% endif %}

<script>
document.getElementById("restore-btn").addEventListener("click", function() {
    document.getElementById("restore-options").style.display = "block";
});

document.getElementById("cancel-restore").addEventListener("click", function() {
    document.getElementById("restore-options").style.display = "none";
});

document.getElementById("restore-form").addEventListener("submit", async function(e) {
    e.preventDefault();
    const duration = document.getElementById("duration").value;

    const response = await fetch(`/admin/users/{{ chat_id }}/restore_subscription`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({duration: parseInt(duration)})
    });

    if (response.ok) {
        location.reload(); // Перезагружаем страницу, чтобы показать новый статус
    } else {
        alert("Ошибка восстановления подписки");
    }
});
</script>

{% endblock %}
