{% extends "admin/layout.html" %}

{% block content %}
<h1>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h1>

<p><strong>Username:</strong> {{ username }}</p>
<p><strong>chat_id:</strong> {{ chat_id }}</p>
<p><strong>–°–ª–µ–¥—É—é—â–∏–π refresh:</strong> {{ next_refresh }}</p>
<p><strong>–°–∞–π—Ç:</strong> <a href="{{ profile_link }}" target="_blank">{{ site_name }}</a></p>
<p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ status }}</p>


<h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
{% if "–ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" in status %}
    <button id="restore-btn">üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
{% else %}
    <form method="post" action="/admin/users/{{ chat_id }}/toggle_status" style="display:inline;">
        <button type="submit">‚è∏ –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
    </form>
{% endif %}

<div id="restore-options" style="display:none; margin-top:10px; border:1px solid #ccc; padding:10px;">
    <b>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –Ω–∞:</b><br><br>

    <div>
        <b>–ú–∏–Ω—É—Ç—ã:</b><br>
        <button type="button" onclick="restoreSub(3,'minutes')">3 –º–∏–Ω—É—Ç—ã</button>
        <button type="button" onclick="restoreSub(30,'minutes')">30 –º–∏–Ω—É—Ç</button>
        <button type="button" onclick="restoreSub(60,'minutes')">1 —á–∞—Å</button>
    </div>

    <br>

    <div>
        <b>–î–Ω–∏:</b><br>
        <button type="button" onclick="restoreSub(1,'days')">1 –¥–µ–Ω—å</button>
        <button type="button" onclick="restoreSub(7,'days')">7 –¥–Ω–µ–π</button>
        <button type="button" onclick="restoreSub(30,'days')">30 –¥–Ω–µ–π</button>
    </div>

    <br>
    <button type="button" id="cancel-restore">–û—Ç–º–µ–Ω–∞</button>
</div>

<form method="post" action="/admin/users/{{ chat_id }}/tokens" style="display:inline-block; margin-left:10px;">
    <button type="submit">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–∫–µ–Ω—ã</button>
</form>

<a href="/admin/users" style="margin-left:20px;">‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>

{% if tokens %}
<h3>–¢–æ–∫–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
<p><strong>Access Token:</strong> {{ tokens.access_token }}</p>
<p><strong>Refresh Token:</strong> {{ tokens.refresh_token }}</p>
{% endif %}

<script>
document.getElementById("restore-btn")?.addEventListener("click", function() {
    document.getElementById("restore-options").style.display = "block";
});

document.getElementById("cancel-restore").addEventListener("click", function() {
    document.getElementById("restore-options").style.display = "none";
});

function restoreSub(value, unit) {
    fetch(`/admin/users/{{ chat_id }}/restore_subscription`, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `value=${value}&unit=${unit}`
    }).then(() => location.reload());
}
</script>

{% endblock %}
