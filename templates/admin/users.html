{% extends "admin/layout.html" %}

{% block content %}
<div class="admin-container">
<h1>Пользователи</h1>

<div style="margin-bottom: 10px;">
    <button class="filter-btn active" data-status="all">Все</button>
    <button class="filter-btn" data-status="active">Активные</button>
    <button class="filter-btn" data-status="inactive">Неактивные</button>
</div>

<div id="users-table">
    <table border="1" cellpadding="8" cellspacing="0">
        <tr>
            <th>ID пользователя</th>
            <th>Статус</th>
        </tr>
        {% for user in users %}
        <tr>
            <td class="user-id"><a href="/admin/users/{{ user.chat_id }}">{{ user.username }}</a></td>
            <td class="status {{ 'active' if user.active else 'inactive' }}">
                {{ "Активен" if user.active else "Неактивен" }}
            </td>
        </tr>
        {% endfor %}
    </table>
</div>

<script>
function initUsersList() {
    const buttons = document.querySelectorAll(".filter-btn");
    const tableContainer = document.getElementById("users-table");

    async function updateUsersTable(status) {
        const res = await fetch(`/admin/users/filter?status=${status}`);
        const users = await res.json();

        let html = `<table border="1" cellpadding="8" cellspacing="0">
            <tr>
                <th>ID пользователя</th>
                <th>Статус</th>
            </tr>`;

        users.forEach(u => {
            html += `<tr>
                <td class="user-id"><a href="/admin/users/${u.chat_id}">${u.username}</a></td>
                <td class="status ${u.active ? 'active' : 'inactive'}">
                    ${u.active ? 'Активен' : 'Неактивен'}
                </td>
            </tr>`;
        });

        html += "</table>";
        tableContainer.innerHTML = html;
    }

    buttons.forEach(btn => {
        btn.addEventListener("click", () => {
            buttons.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");

            const status = btn.dataset.status;
            updateUsersTable(status);
        });
    });
}

// Вызов функции будет выполняться автоматически после SPA-подгрузки
initUsersList();
</script>

<style>
.filter-btn.active {
    background-color: #4CAF50;
    color: white;
}
.filter-btn {
    margin-right: 5px;
    padding: 5px 10px;
    cursor: pointer;
}

.user-id a {
    color: #ffffff;
    font-weight: 600;
    text-decoration: none;
}
.user-id a:hover {
    text-decoration: underline;
}

.status.active {
    color: #4CAF50;
    font-weight: 600;
}

.status.inactive {
    color: #FF1C1C;
    font-weight: 600;
}
</style>
</div>
{% endblock %}